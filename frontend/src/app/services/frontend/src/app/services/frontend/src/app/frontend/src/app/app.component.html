<main class="min-h-screen container mx-auto p-4 md:p-8 flex flex-col items-center relative z-10">
  <header class="text-center mb-8">
    <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-cyan-300 via-fuchsia-400 to-indigo-500 text-transparent bg-clip-text">
      Enterprise Transcreation Engine
    </h1>
    <p class="text-slate-400 mt-2 text-lg">AI-Powered Subtitles with Long-Term Memory</p>
  </header>

  @if (appState() === 'idle' || appState() === 'uploading' || appState() === 'failed' || appState() === 'completed') {
    <div class="w-full max-w-5xl bg-slate-900/70 backdrop-blur-xl rounded-3xl shadow-2xl shadow-black/50 ring-1 ring-white/10 p-6 md:p-8">
      @if (appState() === 'completed') {
        <div class="text-center p-8">
          <h2 class="text-2xl font-bold text-green-400">Translation Complete!</h2>
          <p class="text-slate-300 mt-2">Your corrected translation has been saved.</p>
          <button (click)="startNew()" class="mt-6 bg-cyan-500 hover:bg-cyan-400 text-white font-bold py-2 px-6 rounded-lg">Start New Translation</button>
        </div>
      } @else {
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <div class="flex flex-col gap-6">
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">1. Upload English SRT File (Required)</label>
              <div class="relative w-full h-24 border-2 border-dashed border-slate-700 rounded-lg flex flex-col items-center justify-center text-slate-400 hover:border-cyan-400 transition-all">
                <input type="file" (change)="onFileSelected($event, 'subtitle')" accept=".srt" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" [disabled]="isProcessing()">
                <p class="text-sm font-semibold text-cyan-300">{{ selectedFileName() || 'Select SRT File' }}</p>
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">2. Upload Glossary JSON (Optional)</label>
              <div class="relative w-full h-24 border-2 border-dashed border-slate-700 rounded-lg flex flex-col items-center justify-center text-slate-400 hover:border-fuchsia-400 transition-all">
                <input type="file" (change)="onFileSelected($event, 'glossary')" accept=".json" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" [disabled]="isProcessing()">
                <p class="text-sm font-semibold text-fuchsia-300">{{ selectedGlossaryFileName() || 'Select Glossary File' }}</p>
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-slate-300 mb-2">3. Select Translation Tone</label>
              <div class="grid grid-cols-3 gap-2">
                @for (tone of tones; track tone) { <button type="button" (click)="selectedTone.set(tone)" [class]="selectedTone() === tone ? 'bg-cyan-400/20 text-cyan-300' : 'bg-slate-800/60 text-slate-300'" class="text-center rounded-lg py-2 px-3 text-sm font-semibold transition-all" [disabled]="isProcessing()">{{ tone }}</button> }
              </div>
            </div>
            <button (click)="onTranslate()" [disabled]="isProcessing() || !selectedFile()" class="w-full bg-gradient-to-r from-cyan-500 to-indigo-700 text-white font-semibold py-3 rounded-lg disabled:from-slate-600 disabled:to-slate-700 disabled:cursor-not-allowed flex items-center justify-center">
              @if(appState() === 'uploading') { <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> }
              <span>{{ appState() === 'failed' ? 'Try Again' : 'Translate' }}</span>
            </button>
          </div>
          <div class="bg-slate-800/50 p-4 rounded-lg">
            <h3 class="font-bold text-white">Instructions</h3>
            <ol class="list-decimal list-inside mt-2 text-sm text-slate-300 space-y-2">
              <li>Upload your master English `.srt` file.</li>
              <li>Optionally, upload a custom glossary. It must be a JSON array like: `[{"term": "Firewall", "translation": "فایروال"}]`</li>
              <li>Choose the desired tone for the translation.</li>
              <li>Click Translate to begin the AI process.</li>
            </ol>
            @if (error()) { <div class="mt-4 bg-red-900/50 border border-red-700 text-red-300 p-3 rounded-lg text-sm" role="alert"><strong>Error:</strong> {{ error() }}</div> }
          </div>
        </div>
      }
    </div>
  } @else if (appState() === 'processing') {
    <div class="w-full max-w-md bg-slate-900/70 backdrop-blur-xl rounded-3xl shadow-2xl p-8 text-center">
        <svg class="animate-spin h-12 w-12 text-cyan-400 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
        <h2 class="mt-4 text-xl font-bold text-slate-200">Translation in Progress</h2>
        <p class="text-slate-400 mt-2 h-6">{{ jobProgress() }}</p>
    </div>
  } @else if (appState() === 'reviewing') {
    <div class="w-full max-w-7xl">
      <div class="text-center mb-4">
        <h2 class="text-xl font-bold text-slate-200">Review & Correct AI Translation</h2>
        <p class="text-slate-400">Your edits improve our future translations. Thank you!</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <h3 class="text-lg font-semibold text-slate-200 mb-2 text-center">Original English</h3>
          <textarea readonly class="w-full h-[60vh] bg-slate-800 border border-slate-700 rounded-lg p-3 text-slate-300 resize-none font-mono text-sm">{{ originalSrt() }}</textarea>
        </div>
        <div>
          <h3 class="text-lg font-semibold text-slate-200 mb-2 text-center">AI Translation (Editable)</h3>
          <textarea [value]="userCorrection()" (input)="onCorrectionChange($event)" class="w-full h-[60vh] bg-slate-900 border border-cyan-400 rounded-lg p-3 text-cyan-200 resize-none font-persian text-sm"></textarea>
        </div>
      </div>
      <div class="mt-4 text-center">
        <button (click)="submitAndFinish()" class="bg-cyan-500 hover:bg-cyan-400 text-white font-bold py-2 px-6 rounded-lg">Accept & Finish</button>
      </div>
    </div>
  }
</main>
